/* 
 * Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.
 */

package com.goshippo.sdk;

import com.fasterxml.jackson.core.type.TypeReference;
import com.goshippo.sdk.models.components.CarrierAccount;
import com.goshippo.sdk.models.components.CarrierAccountBase;
import com.goshippo.sdk.models.components.CarrierAccountPaginatedList;
import com.goshippo.sdk.models.components.CarrierAccountRegistrationStatus;
import com.goshippo.sdk.models.components.ConnectExistingOwnAccountRequest;
import com.goshippo.sdk.models.errors.InitiateOauth2SigninCarrierAccountsResponseBody;
import com.goshippo.sdk.models.errors.InitiateOauth2SigninCarrierAccountsResponseResponseBody;
import com.goshippo.sdk.models.errors.InitiateOauth2SigninResponseBody;
import com.goshippo.sdk.models.errors.SDKError;
import com.goshippo.sdk.models.operations.Carrier;
import com.goshippo.sdk.models.operations.CreateCarrierAccountRequest;
import com.goshippo.sdk.models.operations.CreateCarrierAccountRequestBuilder;
import com.goshippo.sdk.models.operations.CreateCarrierAccountResponse;
import com.goshippo.sdk.models.operations.GetCarrierAccountRequest;
import com.goshippo.sdk.models.operations.GetCarrierAccountRequestBuilder;
import com.goshippo.sdk.models.operations.GetCarrierAccountResponse;
import com.goshippo.sdk.models.operations.GetCarrierRegistrationStatusRequest;
import com.goshippo.sdk.models.operations.GetCarrierRegistrationStatusRequestBuilder;
import com.goshippo.sdk.models.operations.GetCarrierRegistrationStatusResponse;
import com.goshippo.sdk.models.operations.InitiateOauth2SigninRequest;
import com.goshippo.sdk.models.operations.InitiateOauth2SigninRequestBuilder;
import com.goshippo.sdk.models.operations.InitiateOauth2SigninResponse;
import com.goshippo.sdk.models.operations.ListCarrierAccountsRequest;
import com.goshippo.sdk.models.operations.ListCarrierAccountsRequestBuilder;
import com.goshippo.sdk.models.operations.ListCarrierAccountsResponse;
import com.goshippo.sdk.models.operations.RegisterCarrierAccountRequest;
import com.goshippo.sdk.models.operations.RegisterCarrierAccountRequestBody;
import com.goshippo.sdk.models.operations.RegisterCarrierAccountRequestBuilder;
import com.goshippo.sdk.models.operations.RegisterCarrierAccountResponse;
import com.goshippo.sdk.models.operations.SDKMethodInterfaces.*;
import com.goshippo.sdk.models.operations.UpdateCarrierAccountRequest;
import com.goshippo.sdk.models.operations.UpdateCarrierAccountRequestBuilder;
import com.goshippo.sdk.models.operations.UpdateCarrierAccountResponse;
import com.goshippo.sdk.utils.HTTPClient;
import com.goshippo.sdk.utils.HTTPRequest;
import com.goshippo.sdk.utils.Hook.AfterErrorContextImpl;
import com.goshippo.sdk.utils.Hook.AfterSuccessContextImpl;
import com.goshippo.sdk.utils.Hook.BeforeRequestContextImpl;
import com.goshippo.sdk.utils.SerializedBody;
import com.goshippo.sdk.utils.Utils.JsonShape;
import com.goshippo.sdk.utils.Utils;
import java.io.InputStream;
import java.lang.Exception;
import java.lang.Object;
import java.lang.String;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.List;
import java.util.Optional; 

/**
 * Carriers are the companies who deliver your package. Shippo uses Carrier account objects as credentials to retrieve shipping rates and purchase labels from shipping Carriers.
 * 
 * &lt;SchemaDefinition schemaRef="#/components/schemas/CarrierAccount"/&gt;
 */
public class CarrierAccounts implements
            MethodCallListCarrierAccounts,
            MethodCallCreateCarrierAccount,
            MethodCallGetCarrierAccount,
            MethodCallUpdateCarrierAccount,
            MethodCallInitiateOauth2Signin,
            MethodCallRegisterCarrierAccount,
            MethodCallGetCarrierRegistrationStatus {

    private final SDKConfiguration sdkConfiguration;

    CarrierAccounts(SDKConfiguration sdkConfiguration) {
        this.sdkConfiguration = sdkConfiguration;
    }


    /**
     * List all carrier accounts
     * Returns a list of all carrier accounts connected to your Shippo account. These carrier accounts include both Shippo carrier accounts and your own carrier accounts that you have connected to your Shippo account.
     * 
     * Additionally, you can get information about the service levels associated with each carrier account by passing in the `?service_levels=true` query parameter. &lt;br&gt;
     * Using it appends the property `service_levels` to each carrier account. &lt;br&gt;
     * By default, if the query parameter is omitted, the `service_levels` property will not be included in the response.
     * @return The call builder
     */
    public ListCarrierAccountsRequestBuilder list() {
        return new ListCarrierAccountsRequestBuilder(this);
    }

    /**
     * List all carrier accounts
     * Returns a list of all carrier accounts connected to your Shippo account. These carrier accounts include both Shippo carrier accounts and your own carrier accounts that you have connected to your Shippo account.
     * 
     * Additionally, you can get information about the service levels associated with each carrier account by passing in the `?service_levels=true` query parameter. &lt;br&gt;
     * Using it appends the property `service_levels` to each carrier account. &lt;br&gt;
     * By default, if the query parameter is omitted, the `service_levels` property will not be included in the response.
     * @param request The request object containing all of the parameters for the API call.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public ListCarrierAccountsResponse list(
            ListCarrierAccountsRequest request) throws Exception {
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                _baseUrl,
                "/carrier_accounts");
        
        HTTPRequest _req = new HTTPRequest(_url, "GET");
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);

        _req.addQueryParams(Utils.getQueryParams(
                ListCarrierAccountsRequest.class,
                request, 
                this.sdkConfiguration.globals));
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "ListCarrierAccounts", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "ListCarrierAccounts",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "ListCarrierAccounts",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "ListCarrierAccounts",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        ListCarrierAccountsResponse.Builder _resBuilder = 
            ListCarrierAccountsResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        ListCarrierAccountsResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "200")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccountPaginatedList _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccountPaginatedList>() {});
                _res.withCarrierAccountPaginatedList(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Create a new carrier account
     * Creates a new carrier account or connects an existing carrier account to the Shippo account.
     * @return The call builder
     */
    public CreateCarrierAccountRequestBuilder create() {
        return new CreateCarrierAccountRequestBuilder(this);
    }

    /**
     * Create a new carrier account
     * Creates a new carrier account or connects an existing carrier account to the Shippo account.
     * @param connectExistingOwnAccountRequest
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public CreateCarrierAccountResponse create(
            ConnectExistingOwnAccountRequest connectExistingOwnAccountRequest) throws Exception {
        return create(Optional.empty(), connectExistingOwnAccountRequest);
    }
    
    /**
     * Create a new carrier account
     * Creates a new carrier account or connects an existing carrier account to the Shippo account.
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @param connectExistingOwnAccountRequest
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public CreateCarrierAccountResponse create(
            Optional<String> shippoApiVersion,
            ConnectExistingOwnAccountRequest connectExistingOwnAccountRequest) throws Exception {
        CreateCarrierAccountRequest request =
            CreateCarrierAccountRequest
                .builder()
                .shippoApiVersion(shippoApiVersion)
                .connectExistingOwnAccountRequest(connectExistingOwnAccountRequest)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                _baseUrl,
                "/carrier_accounts");
        
        HTTPRequest _req = new HTTPRequest(_url, "POST");
        Object _convertedRequest = Utils.convertToShape(
                request, 
                JsonShape.DEFAULT,
                new TypeReference<Object>() {});
        SerializedBody _serializedRequestBody = Utils.serializeRequestBody(
                _convertedRequest, 
                "connectExistingOwnAccountRequest",
                "json",
                false);
        if (_serializedRequestBody == null) {
            throw new Exception("Request body is required");
        }
        _req.setBody(Optional.ofNullable(_serializedRequestBody));
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "CreateCarrierAccount", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "CreateCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "CreateCarrierAccount",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "CreateCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        CreateCarrierAccountResponse.Builder _resBuilder = 
            CreateCarrierAccountResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        CreateCarrierAccountResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "201")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccount _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccount>() {});
                _res.withCarrierAccount(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Retrieve a carrier account
     * Returns an existing carrier account using an object ID.
     * @return The call builder
     */
    public GetCarrierAccountRequestBuilder get() {
        return new GetCarrierAccountRequestBuilder(this);
    }

    /**
     * Retrieve a carrier account
     * Returns an existing carrier account using an object ID.
     * @param carrierAccountId Object ID of the carrier account
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public GetCarrierAccountResponse get(
            String carrierAccountId) throws Exception {
        return get(carrierAccountId, Optional.empty());
    }
    
    /**
     * Retrieve a carrier account
     * Returns an existing carrier account using an object ID.
     * @param carrierAccountId Object ID of the carrier account
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public GetCarrierAccountResponse get(
            String carrierAccountId,
            Optional<String> shippoApiVersion) throws Exception {
        GetCarrierAccountRequest request =
            GetCarrierAccountRequest
                .builder()
                .carrierAccountId(carrierAccountId)
                .shippoApiVersion(shippoApiVersion)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                GetCarrierAccountRequest.class,
                _baseUrl,
                "/carrier_accounts/{CarrierAccountId}",
                request, this.sdkConfiguration.globals);
        
        HTTPRequest _req = new HTTPRequest(_url, "GET");
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "GetCarrierAccount", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "GetCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "GetCarrierAccount",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "GetCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        GetCarrierAccountResponse.Builder _resBuilder = 
            GetCarrierAccountResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        GetCarrierAccountResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "200")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccount _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccount>() {});
                _res.withCarrierAccount(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Update a carrier account
     * Updates an existing carrier account object. The account_id and carrier can't be updated. This is because they form the unique identifier together.
     * @return The call builder
     */
    public UpdateCarrierAccountRequestBuilder update() {
        return new UpdateCarrierAccountRequestBuilder(this);
    }

    /**
     * Update a carrier account
     * Updates an existing carrier account object. The account_id and carrier can't be updated. This is because they form the unique identifier together.
     * @param carrierAccountId Object ID of the carrier account
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public UpdateCarrierAccountResponse update(
            String carrierAccountId) throws Exception {
        return update(carrierAccountId, Optional.empty(), Optional.empty());
    }
    
    /**
     * Update a carrier account
     * Updates an existing carrier account object. The account_id and carrier can't be updated. This is because they form the unique identifier together.
     * @param carrierAccountId Object ID of the carrier account
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @param carrierAccountBase
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public UpdateCarrierAccountResponse update(
            String carrierAccountId,
            Optional<String> shippoApiVersion,
            Optional<? extends CarrierAccountBase> carrierAccountBase) throws Exception {
        UpdateCarrierAccountRequest request =
            UpdateCarrierAccountRequest
                .builder()
                .carrierAccountId(carrierAccountId)
                .shippoApiVersion(shippoApiVersion)
                .carrierAccountBase(carrierAccountBase)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                UpdateCarrierAccountRequest.class,
                _baseUrl,
                "/carrier_accounts/{CarrierAccountId}",
                request, this.sdkConfiguration.globals);
        
        HTTPRequest _req = new HTTPRequest(_url, "PUT");
        Object _convertedRequest = Utils.convertToShape(
                request, 
                JsonShape.DEFAULT,
                new TypeReference<Object>() {});
        SerializedBody _serializedRequestBody = Utils.serializeRequestBody(
                _convertedRequest, 
                "carrierAccountBase",
                "json",
                false);
        _req.setBody(Optional.ofNullable(_serializedRequestBody));
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "UpdateCarrierAccount", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "UpdateCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "UpdateCarrierAccount",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "UpdateCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        UpdateCarrierAccountResponse.Builder _resBuilder = 
            UpdateCarrierAccountResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        UpdateCarrierAccountResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "200")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccount _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccount>() {});
                _res.withCarrierAccount(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Connect an existing carrier account using OAuth 2.0
     * Used by client applications to setup or reconnect an existing carrier account with carriers that support OAuth 2.0
     * @return The call builder
     */
    public InitiateOauth2SigninRequestBuilder initiateOauth2Signin() {
        return new InitiateOauth2SigninRequestBuilder(this);
    }

    /**
     * Connect an existing carrier account using OAuth 2.0
     * Used by client applications to setup or reconnect an existing carrier account with carriers that support OAuth 2.0
     * @param carrierAccountObjectId The carrier account ID (UUID) to start a signin process.
     * @param redirectUri Callback URL. The URL that tells the authorization server where to send the user back to after they approve the request.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public InitiateOauth2SigninResponse initiateOauth2Signin(
            String carrierAccountObjectId,
            String redirectUri) throws Exception {
        return initiateOauth2Signin(carrierAccountObjectId, redirectUri, Optional.empty(), Optional.empty());
    }
    
    /**
     * Connect an existing carrier account using OAuth 2.0
     * Used by client applications to setup or reconnect an existing carrier account with carriers that support OAuth 2.0
     * @param carrierAccountObjectId The carrier account ID (UUID) to start a signin process.
     * @param redirectUri Callback URL. The URL that tells the authorization server where to send the user back to after they approve the request.
     * @param state A random string generated by the consuming application and included in the request to prevent CSRF attacks. The consuming application checks that the same value is returned after the user authorizes Shippo.
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public InitiateOauth2SigninResponse initiateOauth2Signin(
            String carrierAccountObjectId,
            String redirectUri,
            Optional<String> state,
            Optional<String> shippoApiVersion) throws Exception {
        InitiateOauth2SigninRequest request =
            InitiateOauth2SigninRequest
                .builder()
                .carrierAccountObjectId(carrierAccountObjectId)
                .redirectUri(redirectUri)
                .state(state)
                .shippoApiVersion(shippoApiVersion)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                InitiateOauth2SigninRequest.class,
                _baseUrl,
                "/carrier_accounts/{CarrierAccountObjectId}/signin/initiate",
                request, this.sdkConfiguration.globals);
        
        HTTPRequest _req = new HTTPRequest(_url, "GET");
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);

        _req.addQueryParams(Utils.getQueryParams(
                InitiateOauth2SigninRequest.class,
                request, 
                this.sdkConfiguration.globals));
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "InitiateOauth2Signin", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "401", "404", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "InitiateOauth2Signin",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "InitiateOauth2Signin",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "InitiateOauth2Signin",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        InitiateOauth2SigninResponse.Builder _resBuilder = 
            InitiateOauth2SigninResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        InitiateOauth2SigninResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "302")) {
            _res.withHeaders(_httpRes.headers().map());
            // no content 
            return _res;
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                InitiateOauth2SigninResponseBody _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<InitiateOauth2SigninResponseBody>() {});
                    _out.withRawResponse(Optional.ofNullable(_httpRes));
                
                throw _out;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "401")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                InitiateOauth2SigninCarrierAccountsResponseBody _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<InitiateOauth2SigninCarrierAccountsResponseBody>() {});
                    _out.withRawResponse(Optional.ofNullable(_httpRes));
                
                throw _out;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "404")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                InitiateOauth2SigninCarrierAccountsResponseResponseBody _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<InitiateOauth2SigninCarrierAccountsResponseResponseBody>() {});
                    _out.withRawResponse(Optional.ofNullable(_httpRes));
                
                throw _out;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Add a Shippo carrier account
     * Adds a Shippo carrier account
     * @return The call builder
     */
    public RegisterCarrierAccountRequestBuilder register() {
        return new RegisterCarrierAccountRequestBuilder(this);
    }

    /**
     * Add a Shippo carrier account
     * Adds a Shippo carrier account
     * @param requestBody Examples.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public RegisterCarrierAccountResponse register(
            RegisterCarrierAccountRequestBody requestBody) throws Exception {
        return register(Optional.empty(), requestBody);
    }
    
    /**
     * Add a Shippo carrier account
     * Adds a Shippo carrier account
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @param requestBody Examples.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public RegisterCarrierAccountResponse register(
            Optional<String> shippoApiVersion,
            RegisterCarrierAccountRequestBody requestBody) throws Exception {
        RegisterCarrierAccountRequest request =
            RegisterCarrierAccountRequest
                .builder()
                .shippoApiVersion(shippoApiVersion)
                .requestBody(requestBody)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                _baseUrl,
                "/carrier_accounts/register/new");
        
        HTTPRequest _req = new HTTPRequest(_url, "POST");
        Object _convertedRequest = Utils.convertToShape(
                request, 
                JsonShape.DEFAULT,
                new TypeReference<Object>() {});
        SerializedBody _serializedRequestBody = Utils.serializeRequestBody(
                _convertedRequest, 
                "requestBody",
                "json",
                false);
        if (_serializedRequestBody == null) {
            throw new Exception("Request body is required");
        }
        _req.setBody(Optional.ofNullable(_serializedRequestBody));
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "RegisterCarrierAccount", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "RegisterCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "RegisterCarrierAccount",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "RegisterCarrierAccount",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        RegisterCarrierAccountResponse.Builder _resBuilder = 
            RegisterCarrierAccountResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        RegisterCarrierAccountResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "201")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccount _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccount>() {});
                _res.withCarrierAccount(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }



    /**
     * Get Carrier Registration status
     * Returns the registration status for the given account for the given carrier
     * @return The call builder
     */
    public GetCarrierRegistrationStatusRequestBuilder getRegistrationStatus() {
        return new GetCarrierRegistrationStatusRequestBuilder(this);
    }

    /**
     * Get Carrier Registration status
     * Returns the registration status for the given account for the given carrier
     * @param carrier filter by specific carrier
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public GetCarrierRegistrationStatusResponse getRegistrationStatus(
            Carrier carrier) throws Exception {
        return getRegistrationStatus(carrier, Optional.empty());
    }
    
    /**
     * Get Carrier Registration status
     * Returns the registration status for the given account for the given carrier
     * @param carrier filter by specific carrier
     * @param shippoApiVersion Optional string used to pick a non-default API version to use. See our <a href="https://docs.goshippo.com/docs/api_concepts/apiversioning/">API version</a> guide.
     * @return The response from the API call
     * @throws Exception if the API call fails
     */
    public GetCarrierRegistrationStatusResponse getRegistrationStatus(
            Carrier carrier,
            Optional<String> shippoApiVersion) throws Exception {
        GetCarrierRegistrationStatusRequest request =
            GetCarrierRegistrationStatusRequest
                .builder()
                .carrier(carrier)
                .shippoApiVersion(shippoApiVersion)
                .build();
        
        String _baseUrl = this.sdkConfiguration.serverUrl;
        String _url = Utils.generateURL(
                _baseUrl,
                "/carrier_accounts/reg-status");
        
        HTTPRequest _req = new HTTPRequest(_url, "GET");
        _req.addHeader("Accept", "application/json")
            .addHeader("user-agent", 
                SDKConfiguration.USER_AGENT);

        _req.addQueryParams(Utils.getQueryParams(
                GetCarrierRegistrationStatusRequest.class,
                request, 
                this.sdkConfiguration.globals));
        _req.addHeaders(Utils.getHeadersFromMetadata(request, this.sdkConfiguration.globals));

        Utils.configureSecurity(_req,  
                this.sdkConfiguration.securitySource.getSecurity());

        HTTPClient _client = this.sdkConfiguration.defaultClient;
        HttpRequest _r = 
            sdkConfiguration.hooks()
               .beforeRequest(
                  new BeforeRequestContextImpl(
                      "GetCarrierRegistrationStatus", 
                      Optional.of(List.of()), 
                      sdkConfiguration.securitySource()),
                  _req.build());
        HttpResponse<InputStream> _httpRes;
        try {
            _httpRes = _client.send(_r);
            if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
                _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "GetCarrierRegistrationStatus",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()),
                        Optional.of(_httpRes),
                        Optional.empty());
            } else {
                _httpRes = sdkConfiguration.hooks()
                    .afterSuccess(
                        new AfterSuccessContextImpl(
                            "GetCarrierRegistrationStatus",
                            Optional.of(List.of()), 
                            sdkConfiguration.securitySource()),
                         _httpRes);
            }
        } catch (Exception _e) {
            _httpRes = sdkConfiguration.hooks()
                    .afterError(
                        new AfterErrorContextImpl(
                            "GetCarrierRegistrationStatus",
                            Optional.of(List.of()),
                            sdkConfiguration.securitySource()), 
                        Optional.empty(),
                        Optional.of(_e));
        }
        String _contentType = _httpRes
            .headers()
            .firstValue("Content-Type")
            .orElse("application/octet-stream");
        GetCarrierRegistrationStatusResponse.Builder _resBuilder = 
            GetCarrierRegistrationStatusResponse
                .builder()
                .contentType(_contentType)
                .statusCode(_httpRes.statusCode())
                .rawResponse(_httpRes);

        GetCarrierRegistrationStatusResponse _res = _resBuilder.build();
        
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "200")) {
            if (Utils.contentTypeMatches(_contentType, "application/json")) {
                CarrierAccountRegistrationStatus _out = Utils.mapper().readValue(
                    Utils.toUtf8AndClose(_httpRes.body()),
                    new TypeReference<CarrierAccountRegistrationStatus>() {});
                _res.withCarrierAccountRegistrationStatus(Optional.ofNullable(_out));
                return _res;
            } else {
                throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "Unexpected content-type received: " + _contentType, 
                    Utils.extractByteArrayFromBody(_httpRes));
            }
        }
        if (Utils.statusCodeMatches(_httpRes.statusCode(), "400", "4XX", "5XX")) {
            // no content 
            throw new SDKError(
                    _httpRes, 
                    _httpRes.statusCode(), 
                    "API error occurred", 
                    Utils.extractByteArrayFromBody(_httpRes));
        }
        throw new SDKError(
            _httpRes, 
            _httpRes.statusCode(), 
            "Unexpected status code received: " + _httpRes.statusCode(), 
            Utils.extractByteArrayFromBody(_httpRes));
    }

}
